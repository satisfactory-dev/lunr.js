services:
    devcontainer:
        environment:
            - PORT_BENCHER_API=${PORT_BENCHER_API:-8004}
            - PORT_BENCHER_CONSOLE=${PORT_BENCHER_CONSOLE:-8005}
            - BENCHER_HOST=http://localhost:${PORT_BENCHER_API:-8004}
        build:
            dockerfile: devcontainer.DockerFile
        restart: always
        command: sleep infinity
        volumes:
            - ../../:/workspaces:cached
    docs:
        image: nginxinc/nginx-unprivileged:1.29-alpine
        restart: unless-stopped
        ports:
            - '${PORT_DOCS:-8001}:80'
        volumes:
            - ./docs.conf:/etc/nginx/conf.d/default.conf
            - ../.cache/docs/html/:/app/
    coverage:
        image: nginxinc/nginx-unprivileged:1.29-alpine
        restart: unless-stopped
        ports:
            - '${PORT_COVERAGE:-8002}:80'
        volumes:
            - ./coverage.conf:/etc/nginx/conf.d/default.conf
            - ../coverage/:/app/
    tests:
        image: nginxinc/nginx-unprivileged:1.29-alpine
        restart: unless-stopped
        ports:
            - '${PORT_TESTS:-8003}:80'
        volumes:
            - ./tests.conf:/etc/nginx/conf.d/default.conf
            - ./tests.mime.types:/etc/nginx/mime.types
            - ../test/:/app/
