<html>
<head>
  <meta charset="utf-8">
  <title>Mocha Tests</title>
  <link href="/env/mocha/mocha.css" rel="stylesheet" />
  <script src="/env/mocha/mocha.js"></script>
  <script type="importmap">
    {
      "imports": {
        "@satisfactory-dev/lunr": "./lunr.js",
        "lunr": "./env/lunr/lunr.js",
        "assert/strict": "./env/assert/assert.js",
        "node:test": "./env/404"
      }
    }
  </script>
  <script type="module">
    globalThis.process = {
      env: {
      }
    };
  </script>
</head>
<body>
  <div id="mocha"></div>
  <script src="/env/lunr/lunr.js"></script>
  <script>
    mocha.setup('tdd')
  </script>
  <script type="module">
    globalThis.upstreamLunr = globalThis.lunr

    import lunr from '/lunr.js';

    import test_files from '/env/file_list.json' with {type: 'json'}

    globalThis.lunr = lunr;

    const pending = [];

    for (
      const src of test_files
        .filter((maybe) => /^[a-z][a-z_]+\.js$/.test(maybe))
    ) {
      pending.push(import(`./${src}`))
    }

    await Promise.all(pending)

    mocha.checkLeaks();
    mocha.globals(['lunr']);
    mocha.run();
  </script>
</body>
</html>
